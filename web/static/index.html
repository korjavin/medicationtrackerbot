<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Med Tracker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="static/css/styles.css?v=TIMESTAMP_PLACEHOLDER">
    <style>
        /* Fallback if css doesn't load immediately */
        body {
            font-family: -apple-system, BlinkMacMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
    </style>
</head>

<body>
    <div id="app">
        <header>
            <h1>My Medications</h1>
        </header>

        <div id="tabs">
            <button class="tab active" onclick="switchTab('meds')">Medications</button>
            <button class="tab" onclick="switchTab('history')">History</button>
        </div>

        <div id="meds-view" class="view active">
            <div id="med-list">
                <!-- Meds injected here -->
            </div>
            <button id="add-btn" onclick="showAddModal()">+ Add Medication</button>
        </div>

        <div id="history-view" class="view">
            <h3>Intake History</h3>

            <div class="filters">
                <select id="history-filter-med" onchange="loadHistory()">
                    <option value="0">All Medications</option>
                </select>
                <select id="history-filter-days" onchange="loadHistory()">
                    <option value="1">Last 24 Hours</option>
                    <option value="3" selected>Last 3 Days</option>
                    <option value="7">Last 7 Days</option>
                </select>
            </div>

            <div id="history-list"></div>
        </div>
    </div>

    <!-- Modal for Adding Med -->
    <div id="modal-overlay" class="hidden"></div>
    <div id="med-modal" class="hidden">
        <h3>Add Medication</h3>
        <input type="text" id="med-name" placeholder="Name (e.g. Aspirin)">
        <input type="text" id="med-dosage" placeholder="Dosage (e.g. 100mg)">
        <p id="med-rx-display" style="font-size: 0.85em; color: var(--hint-color); margin-top: 5px; display: none;"></p>

        <label>Schedule Type:</label>
        <select id="schedule-type" onchange="toggleScheduleFields()">
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="as_needed">As Needed</option>
        </select>

        <div id="days-container" class="hidden">
            <label>Days:</label>
            <div class="days-select">
                <span data-day="1" onclick="toggleDay(this)">Mon</span>
                <span data-day="2" onclick="toggleDay(this)">Tue</span>
                <span data-day="3" onclick="toggleDay(this)">Wed</span>
                <span data-day="4" onclick="toggleDay(this)">Thu</span>
                <span data-day="5" onclick="toggleDay(this)">Fri</span>
                <span data-day="6" onclick="toggleDay(this)">Sat</span>
                <span data-day="0" onclick="toggleDay(this)">Sun</span>
            </div>
        </div>

        <div id="times-container">
            <label>Times:</label>
            <div id="time-inputs">
                <div class="time-row">
                    <input type="time" class="med-time-input">
                    <button class="remove-time" onclick="removeTime(this)">Ã—</button>
                </div>
            </div>
            <button class="small-btn" onclick="addTimeInput()">+ Add Time</button>
        </div>

        <div class="form-row">
            <label>Start Date (Optional):</label>
            <input type="date" id="med-start-date">
        </div>
        <div class="form-row">
            <label>End Date (Optional):</label>
            <input type="date" id="med-end-date">
        </div>

        <div class="form-row">
            <label class="checkbox-label">
                <input type="checkbox" id="med-archived"> Archived
            </label>
        </div>

        <div class="actions">
            <button onclick="closeModal()" class="secondary">Cancel</button>
            <button onclick="saveMedication()" class="primary">Save</button>
        </div>
    </div>

    <script src="static/js/app.js?v=TIMESTAMP_PLACEHOLDER"></script>
</body>

</html>